<app-breadcrumb title="Tarefas">
  <div class="add-task-btn">
    <button mat-flat-button color="primary" (click)="openAddTaskDialog()">
      <mat-icon>add</mat-icon>
      Nova Tarefa
    </button>
  </div>
</app-breadcrumb>

<div class="board-columns" cdkDropListGroup>
  <!-- TODO COLUMN -->
  <app-card class="column-card">
    <div class="column-header">
      <span class="dot blue"></span>
      <h3>A Fazer</h3>
    </div>

    <div
      cdkDropList
      id="todo"
      [cdkDropListData]="todo()"
      [cdkDropListConnectedTo]="['doing', 'done']"
      (cdkDropListDropped)="drop($event)"
      class="task-list"
    >
      @for (task of todo(); track task.id) {
        <div cdkDrag class="task-card">
          <div class="task-header">
            <h4>{{ task.title }}</h4>
            <button mat-icon-button class="play-btn">
              <mat-icon>play_circle_filled</mat-icon>
            </button>
          </div>
          <div class="task-meta">
            <span class="time-badge">
              <mat-icon>schedule</mat-icon>
              @if (task.timeType === "tempo_fixo") {
                {{ task.timeSpend }} min
              } @else {
                {{ task.createdAt | date: "dd/MM/yy HH:mm" }}
              }
            </span>
          </div>
          @if (task.description) {
            <p class="task-desc">{{ task.description }}</p>
          }
        </div>
      }
      @if (todo().length === 0) {
        <div class="empty-state">Nenhuma tarefa a fazer</div>
      }
    </div>
  </app-card>

  <!-- DOING COLUMN -->
  <app-card class="column-card">
    <div class="column-header">
      <span class="dot yellow"></span>
      <h3>Em andamento</h3>
    </div>

    <div
      cdkDropList
      id="doing"
      [cdkDropListData]="doing()"
      [cdkDropListConnectedTo]="['todo', 'done']"
      (cdkDropListDropped)="drop($event)"
      class="task-list"
    >
      @for (task of doing(); track task.id) {
        <div cdkDrag class="task-card">
          <div class="task-header">
            <h4>{{ task.title }}</h4>
            <button mat-icon-button class="play-btn">
              <mat-icon>pause_circle_filled</mat-icon>
            </button>
          </div>
          <div class="task-meta">
            <span class="time-badge">
              <mat-icon>schedule</mat-icon>
              @if (task.timeType === "tempo_fixo") {
                {{ task.timeSpend }} min
              } @else {
                {{ task.createdAt | date: "dd/MM/yy HH:mm" }}
              }
            </span>
          </div>
          @if (task.description) {
            <p class="task-desc">{{ task.description }}</p>
          }
        </div>
      }
      @if (doing().length === 0) {
        <div class="empty-state">Nenhuma tarefa em andamento</div>
      }
    </div>
  </app-card>

  <!-- DONE COLUMN -->
  <app-card class="column-card">
    <div class="column-header">
      <span class="dot green"></span>
      <h3>Concluido</h3>
    </div>

    <div
      cdkDropList
      id="done"
      [cdkDropListData]="done()"
      [cdkDropListConnectedTo]="['todo', 'doing']"
      (cdkDropListDropped)="drop($event)"
      class="task-list"
    >
      @for (task of done(); track task.id) {
        <div cdkDrag class="task-card">
          <div class="task-header">
            <h4>{{ task.title }}</h4>
            <button mat-icon-button class="play-btn">
              <mat-icon>check_circle</mat-icon>
            </button>
          </div>
          <div class="task-meta">
            <span class="time-badge">
              <mat-icon>schedule</mat-icon>
              @if (task.timeType === "tempo_fixo") {
                {{ task.timeSpend }} min
              } @else {
                {{ task.createdAt | date: "dd/MM/yy HH:mm" }}
              }
            </span>
          </div>
          @if (task.description) {
            <p class="task-desc">{{ task.description }}</p>
          }
        </div>
      }
      @if (done().length === 0) {
        <div class="empty-state">Nenhuma tarefa conclu√≠da</div>
      }
    </div>
  </app-card>
</div>
